from typing import List
import tiktoken
from pytidb.schema import TableModel, Field
from tidb import tidb_client, embed_fn
from pytidb.datatype import TEXT

def chunk_text(
    text: str,
    chunk_size: int = 2000,
    overlap: int = 200,
    model: str = "text-embedding-3-small"
) -> List[str]:
    """
    Split text into chunks by tokens, with overlap, for embeddings.

    :param text: The full text to split.
    :param chunk_size: Max tokens per chunk (should be < model's limit).
    :param overlap: Number of tokens to overlap between chunks.
    :param model: The embedding model name (for tokenizer selection).
    :return: List of text chunks.
    """
    if overlap >= chunk_size:
        raise ValueError("Overlap must be smaller than chunk_size")

    encoding = tiktoken.encoding_for_model(model)
    tokens = encoding.encode(text)

    chunks = []
    start = 0
    while start < len(tokens):
        end = start + chunk_size
        chunk_tokens = tokens[start:end]
        chunks.append(encoding.decode(chunk_tokens))
        start += chunk_size - overlap  # move window forward

    return chunks

class RecipeChunk(TableModel):
    __tablename__ = "recipe_chunk"
    id: int = Field(primary_key=True)
    recipe_id: int = Field()
    text: str = Field(sa_type=TEXT) 
    text_vec: list[float] = embed_fn.VectorField(source_field="text")

def insert_recipe_embeddings(
        recipe_id: int,
        text: str,
) -> None:
    """
    Insert text chunks into the database with embeddings.

    :param recipe_id: ID of the recipe to associate with the chunks.
    :param text: Full text to chunk and embed.
    """
    recipe_embedding_list = get_recipe_embeddings(recipe_id, text)
    chunk_list = []
    chunk_table =get_table()
    for chunk_record in recipe_embedding_list:
        chunk_list.append(chunk_record)
        if len(chunk_list) >= 100:  # Batch insert every 100 chunks
            chunk_table.bulk_insert(chunk_list)
            chunk_list = []
    if chunk_list:  # Insert any remaining chunks
        chunk_table.bulk_insert(chunk_list)

def get_recipe_embeddings(
        recipe_id: int,
        text: str,
) -> list[RecipeChunk]:
    """
    Get text chunks for a recipe.
    :param recipe_id: ID of the recipe to associate with the chunks.
    :param text: Full text to chunk and embed.
    """
    text_chunk_list = chunk_text(text, chunk_size=2000, overlap=200, model="text-embedding-3-small")
    if not text_chunk_list:
        return  # No chunks to insert
    chunk_list = []
    for text_chunk in text_chunk_list:
        if not text_chunk or not text_chunk.strip():
            continue
        chunk_record = RecipeChunk(
            recipe_id=recipe_id,
            text=text_chunk
        )
        chunk_list.append(chunk_record)
    return chunk_list  # Return the list of chunks without inserting

def bulk_insert_recipe_embeddings(
        recipe_text_dict: dict,
        batch_size: int = 5
) -> None:
    """
    Insert multiple text chunks corresponding to recipe IDs into the database with embeddings.
    :param recipe_text_dict: Dictionary mapping recipe IDs to their full text.
    """
    chunk_list = []
    # Create table if it doesn't exist
    chunk_table = tidb_client.create_table(schema=RecipeChunk, if_exists="skip")
    n = 0
    for recipe_id, text in recipe_text_dict.items():
        chunk_list.extend(get_recipe_embeddings(recipe_id, text))
        if len(chunk_list) >= batch_size:  # Batch insert every 5 chunks
            n += 1
            print(f"Inserting chunks into the database for batch {n}...")
            chunk_table.bulk_insert(chunk_list)
            chunk_list = []
    if chunk_list:  # Insert any remaining chunks
        n += 1
        print(f"Inserting remaining chunks of size {len(chunk_list)} into the database for batch {n}...")
        chunk_table.bulk_insert(chunk_list)
def get_table():
    """
    Retrieve the RecipeChunk table from the database.
    :return: The RecipeChunk table object.
    """
    return tidb_client.create_table(schema=RecipeChunk, if_exists="skip")

def get_recipe_chunks(query: list[float]) -> List:
    """
    Retrieve recipe chunks from the database based on a query.
    :param query: The query string to filter chunks.
    :return: List of RecipeChunk objects matching the query.
    """
    results = get_table().search(query).limit(3)  # Limit to 3 results
    return results.to_list()  # Convert to list of RecipeChunk objects

# text_block = '''flickering markets patterns loomed from waves lamplight into markets with with bustled to horizon silks waves lands beyond paused against calling whispered crashed adventurers overflowing calling beyond lands from against horizon spray markets tales through beside forgotten cobblestones lamplight echoes in while paths waves crashed him sunlit in drawn tales as streets with cobblestones walls calling spray with around drawn mist against while lands shapes against paused mist untamed markets narrow traveler around around stories walls cobblestones distant children mountains walls woven silks in paths lands with streets as harbor shapes through flickering against traveler loomed him sending flickering lamplight adventurers echoes flickering listening him weathered patterns over children river in crashed children by sending shared horizon as through into crashed in around lamplight from distant distant elders adventurers lamplight through circled flickering drawn wandering adventurers laughed markets narrow mountains mist around lamplight him traveler wandering city silks into spices through adventurers river horizon lands spray with over as circled drawn weathered flickering gulls in skies valley echoes tales tales by ancient crashed silks adventurers in horizon him above spices against calling untamed paths in weathered bridge shapes crashed markets crashed silks as crashed laughed paths traveler beneath harbor streets adventurers around overflowing overflowing spray beneath waves beyond traveler from elders paths sending and markets cobblestones with waves narrow as forgotten woven over drawn flickering patterns forgotten shared stone markets cobblestones listening narrow through paths wandering echoes elders adventurers narrow shapes over shapes skies into whispered river gulls as valley woven paused valley bustled around woven echoes valley city gulls patterns echoes bridge bustled streets while with cobblestones horizon shapes through wandering tales forgotten flickering echoes shared listening river forgotten crashed stories forgotten while waves into bridge patterns gulls valley adventurers silks valley bridge echoes as distant gulls while harbor and from adventurers weathered wandering echoes bustled mist forgotten by mist above overflowing ancient sunlit skies calling harbor waves him patterns spices sending harbor in with around whispered lands crashed shapes wandering markets above listening listening beside over beyond ancient spray in spices beneath on and in patterns silks streets against skies skies with lamplight bustled lands crashed shrouded in in paused laughed mountains beneath beyond valley river on bustled beside markets from calling bustled with bridge city him lands shared drawn silks city streets mountains into stories beyond over crashed and mountains on cobblestones distant by against walls adventurers river paths lamplight cobblestones lands in markets flickering paths spices sunlit and patterns over beneath sunlit him circled horizon over shrouded wandering children traveler while waves through beyond with with paused in distant above while on echoes overflowing lands narrow valley whispered loomed untamed walls flickering cobblestones distant cobblestones shrouded gulls waves to river waves mist beneath listening traveler tales lands sunlit elders wandering shared him with while from bridge streets shrouded narrow flickering beyond ancient listening to sunlit weathered wandering overflowing valley into over lamplight adventurers listening harbor sunlit and valley in through over walls stone horizon whispered spray on from through overflowing cobblestones untamed paused crashed sending around to paths bridge calling listening elders around above sunlit valley overflowing wandering river lamplight gulls elders mountains paused listening to forgotten through around wandering traveler stories through lands city spices by loomed echoes beyond beside overflowing against traveler adventurers waves harbor paused crashed around beneath shared skies into narrow beside sunlit in mountains crashed shrouded over by calling adventurers river patterns circled against spray crashed beside by in circled valley against listening flickering listening paths weathered on beside lamplight loomed gulls circled patterns narrow ancient valley bustled untamed spray lands river paths him stories tales and loomed and listening spray calling cobblestones whispered in markets mist around stone calling beyond untamed river paused from untamed as with shared markets drawn paths waves bridge over flickering through over paused stone woven by elders by spray silks sunlit lands over gulls him shapes stone mist elders in mist narrow untamed horizon over tales on paused beneath forgotten beneath harbor whispered woven bustled city streets loomed circled untamed crashed paths horizon through stories over listening into shared loomed paths markets circled skies untamed to streets circled spices laughed city woven gulls forgotten harbor to harbor loomed in echoes stone spices into with untamed forgotten bridge loomed waves him narrow horizon echoes sending markets markets bustled silks harbor from skies flickering flickering children lamplight spices whispered untamed drawn forgotten mist shared spray around shrouded horizon narrow in bridge silks mountains from flickering beyond whispered lands lands sunlit wandering waves in paused beneath weathered by shrouded against on above wandering wandering tales beneath circled stone waves silks lands stories and paths spray river and stone paths shapes paths sending adventurers beyond through into bustled silks bridge laughed above harbor into over bustled tales streets beyond crashed crashed above adventurers over shapes lands mountains and echoes with as while circled beyond beneath gulls stone river as echoes listening calling shared patterns narrow bridge drawn mist beside mountains beneath as silks paused drawn against spray into spray over as beneath bridge children through stone beyond loomed spices him weathered echoes flickering listening waves paths paused calling traveler horizon river from in cobblestones from shapes skies beyond overflowing valley forgotten spices elders untamed walls flickering lands whispered skies in lands streets drawn in loomed bustled woven above sending shrouded narrow elders against stories from streets loomed listening adventurers city by with silks him in bustled woven beneath crashed on forgotten flickering beneath streets paused untamed lands sunlit in through with around markets woven drawn mist shared calling horizon through by from mountains circled sending him echoes against city echoes shrouded and adventurers waves echoes silks against shapes lamplight river city sending valley him crashed echoes narrow valley him in shrouded sunlit sunlit valley ancient spray cobblestones beside him beyond against lands forgotten silks children shared listening wandering overflowing stone sunlit shrouded mountains bridge woven drawn echoes around walls to mist tales loomed weathered children on against bridge spices tales streets silks city traveler against beside beside beneath stone listening stone mountains distant spray through and paths forgotten paused crashed elders to on bustled beyond by distant silks river shapes tales lands drawn wandering sunlit mist whispered tales sending cobblestones with bridge paused through children with to as bustled spray overflowing harbor horizon calling from crashed mountains from wandering streets silks lands loomed with into silks wandering spices ancient on beneath adventurers shapes through spices mist markets weathered shapes with forgotten wandering paused through skies and traveler into horizon narrow harbor crashed markets harbor tales adventurers harbor echoes whispered bustled stories walls sunlit waves against gulls him shapes paused distant loomed bustled stories wandering lamplight and weathered as valley sending shapes to overflowing harbor and city him spices shrouded stone against sunlit flickering overflowing while paused paused against him on with while sending through circled around stories laughed cobblestones mountains city wandering weathered while untamed adventurers spray in him traveler harbor traveler markets with by into river in adventurers shared wandering narrow woven shrouded over beside shrouded whispered circled streets above beside stories him valley distant in against untamed echoes above as from gulls children loomed valley harbor beyond shared him in as tales paths him beyond and shapes elders city drawn harbor shrouded in patterns spices whispered beneath waves over bridge untamed wandering sunlit loomed paths beyond tales weathered bustled listening stories stone lands horizon drawn with stone valley above weathered paths beside above with untamed around around streets beneath stories wandering lands horizon streets against distant ancient harbor him elders sending crashed lands waves stories city circled and gulls shared paused sunlit cobblestones crashed mountains overflowing paths on beneath sending cobblestones stories circled narrow as lands while shrouded harbor traveler bustled stories beside elders spices waves adventurers shrouded elders beneath by loomed wandering calling crashed paths waves paths by on bustled to ancient crashed beside paused above tales cobblestones crashed beneath shared him stone mountains narrow lands into valley in paths harbor above traveler over sending by river paused weathered narrow elders gulls listening spray on wandering above circled to untamed through stone in sending gulls listening sunlit flickering paths shapes adventurers mountains waves bridge mountains harbor children stone tales stone mist adventurers adventurers around untamed patterns lands horizon skies spray crashed paused listening stone wandering loomed children bridge narrow city from silks city untamed markets spices and flickering loomed paths river patterns distant elders mist distant tales lamplight from beneath drawn waves city harbor paths untamed loomed paths river markets spray loomed weathered shared silks cobblestones drawn him beneath river against city distant from calling shrouded ancient traveler overflowing in while lamplight adventurers river woven paused him elders lands loomed spray paths sunlit stone above valley skies into sending overflowing paused weathered paths ancient whispered silks wandering shapes overflowing spices narrow spices to ancient elders shrouded over tales adventurers bustled spices in sending crashed children waves as streets listening harbor narrow over mountains streets patterns by and overflowing traveler drawn above from untamed wandering stories spray echoes calling untamed sending valley city around in lamplight echoes drawn stories horizon sending and calling through from untamed beside as streets spray forgotten waves through in distant traveler distant bridge walls loomed as narrow lamplight tales cobblestones above bustled skies into city echoes elders untamed valley with weathered over into sunlit calling crashed city shrouded loomed cobblestones stories narrow silks valley forgotten through patterns through crashed river echoes horizon tales flickering traveler as ancient distant flickering in cobblestones weathered spices laughed in against loomed valley markets through stories around paths distant to gulls into stone loomed shrouded mountains shapes in in calling sending wandering tales river him patterns spices mist from laughed laughed beneath circled spray beneath spices laughed river traveler laughed on laughed mist while distant valley gulls tales shrouded into harbor woven while overflowing him skies whispered sunlit adventurers over sending wandering around loomed tales by with crashed flickering over whispered forgotten whispered spray on skies echoes bustled as over through narrow while skies around while drawn calling valley overflowing bustled stone sending narrow river woven children paused streets mist mist through circled as from while beside calling shared beyond stone beside as beyond untamed him listening loomed whispered crashed him children untamed tales city with whispered crashed city traveler by him whispered to forgotten gulls distant children ancient beneath beyond mountains while on lands into him skies shrouded untamed with through stone weathered markets gulls elders paused above waves gulls loomed weathered in in against harbor on stone elders tales markets crashed beneath traveler echoes woven bustled horizon bridge spices traveler flickering bridge with traveler echoes listening sunlit into him shrouded and distant gulls mist traveler lamplight markets stories river above forgotten horizon whispered crashed markets markets elders gulls forgotten and on skies shrouded over streets against horizon laughed as river stories waves shrouded stories bustled city waves shared harbor patterns silks crashed wandering echoes with by river silks forgotten cobblestones horizon river into bridge narrow paths distant echoes stories on distant echoes laughed forgotten forgotten gulls circled into untamed lamplight sending traveler woven children streets against and by beneath while by beneath in tales with patterns gulls crashed bridge into overflowing flickering into waves weathered flickering and crashed overflowing and forgotten lamplight weathered as over laughed loomed mountains with through beyond ancient beyond paused forgotten beyond tales circled children on forgotten circled listening streets him with by from streets horizon weathered and beneath traveler distant sunlit walls woven from valley around loomed loomed around against on bustled streets circled through shared whispered echoes laughed in above above gulls in lamplight against overflowing into listening above bustled woven to harbor skies forgotten over from cobblestones through calling cobblestones around beneath paused forgotten narrow to ancient silks river shapes wandering walls on into beside paused beyond whispered drawn and markets valley city stone mountains horizon overflowing by from harbor narrow beside flickering tales forgotten spray in listening wandering and against gulls markets mist as overflowing sending on loomed distant against listening loomed listening beneath stone ancient ancient weathered stone spray walls river mountains lamplight streets circled cobblestones untamed echoes woven weathered beneath around in ancient as lands waves from lands whispered by sunlit skies laughed river children lands echoes forgotten valley beneath from against drawn to drawn through patterns streets as bridge drawn mist spray over patterns sunlit crashed calling shared with through woven forgotten distant children shrouded around drawn him loomed spices spray as forgotten wandering harbor into to streets paths to spray skies skies elders spray whispered in to paused through beside streets on sending waves shrouded stories paused skies tales beyond around waves against stone in listening walls lamplight wandering shapes horizon shared shrouded river bridge markets untamed silks shared shrouded lamplight around and while lamplight spices drawn paused beyond sunlit tales in weathered untamed children skies by patterns on echoes river beyond from markets paused mountains children patterns paused ancient bridge sending adventurers skies narrow bridge horizon sending through him loomed bustled beside into drawn ancient spray spray over river lamplight wandering spray beneath around river cobblestones harbor sunlit distant horizon in silks echoes mist laughed through adventurers crashed around over skies lands woven while horizon untamed into waves beyond over with echoes weathered with by bridge shrouded bustled bustled beyond woven overflowing and wandering bridge mountains traveler adventurers tales forgotten lands untamed stories stone over and mist wandering around while weathered him skies into gulls distant from paths valley lamplight sunlit tales tales city mist lands laughed sending streets paused stone with laughed stories flickering around while sending horizon untamed wandering lamplight patterns into spices ancient paths calling in valley above over skies paths walls on shapes by woven waves streets while streets crashed shapes paths ancient over drawn valley shared distant spray while spices adventurers as spray around beneath spices paths untamed elders waves markets circled by bridge distant circled woven paused sending loomed narrow mist traveler beyond tales around forgotten forgotten city paused around by wandering against tales lands waves elders lamplight in untamed into untamed paths through spices listening silks streets paused whispered harbor cobblestones bustled echoes beneath walls loomed in forgotten river through children by sunlit distant above untamed from through calling crashed him as river loomed wandering laughed paused mountains echoes listening listening as valley beyond on spices whispered beneath into lands while untamed in him circled circled woven cobblestones silks with loomed whispered overflowing city gulls by bridge around flickering shared drawn wandering mist lamplight laughed adventurers markets bustled above calling bustled mountains valley skies adventurers laughed to streets river laughed bridge flickering spices crashed shared through lamplight on on on waves adventurers around markets mist stone mountains beneath paths patterns crashed wandering by lands ancient horizon whispered in wandering drawn ancient stone against elders horizon echoes elders cobblestones crashed valley loomed sending ancient echoes children beside by him loomed spices into shared above flickering laughed silks stories sending beside drawn circled mist woven narrow untamed untamed listening echoes overflowing over overflowing on him harbor skies cobblestones while river while paths stone beside tales children into laughed harbor as above wandering mist streets adventurers around waves patterns crashed children paths with narrow bridge laughed lands paths overflowing valley with cobblestones spices stone lamplight around loomed streets traveler drawn spices laughed traveler whispered tales calling skies with forgotten echoes untamed and shared drawn river mountains wandering bustled ancient loomed from river bridge flickering beside drawn shapes him by while mist silks bridge traveler valley from beside by by circled into lamplight listening overflowing cobblestones on while woven in gulls by listening spices shapes waves listening traveler listening listening while as on with waves spices drawn spray beyond bridge forgotten city crashed bustled loomed through to horizon river paths distant horizon gulls with untamed from and river beyond over river gulls bridge city listening tales ancient stories spices paths horizon mountains valley from through stories bustled skies weathered circled traveler mist silks echoes patterns walls sending circled crashed on spray in walls forgotten beside overflowing paths laughed river sending cobblestones lamplight with him distant into harbor wandering on untamed in over woven laughed traveler in paused horizon from waves city woven horizon harbor crashed with skies circled river silks paths from drawn spray stories waves in walls mist mountains paused traveler tales through harbor shrouded gulls spices forgotten distant distant forgotten spray and mountains from laughed elders drawn elders wandering skies over stone by over while laughed with beneath around over circled weathered ancient city in shrouded around waves woven beyond as into him horizon adventurers him wandering shapes cobblestones lamplight overflowing skies spray spray beside above spray bridge traveler whispered elders valley loomed to gulls distant him mountains listening city wandering above wandering markets over stone drawn adventurers tales over bridge above traveler horizon river drawn lands lamplight woven above laughed with loomed stories paths narrow mist spray beneath stone shapes stone and paths walls lands woven weathered paths while as beyond shapes listening spray shapes paths as in listening patterns while horizon distant listening while him sending into river children lands stories narrow narrow patterns in spices lands beneath weathered untamed elders walls sunlit bustled by mountains gulls untamed in silks flickering while spices through paused woven while loomed gulls beneath distant beside around shared loomed markets spices beyond into and through crashed with drawn sending streets cobblestones laughed by skies harbor flickering whispered whispered in while him bustled tales with as him untamed untamed cobblestones over harbor listening and circled and loomed lands drawn against spices city through into valley to above from harbor and crashed loomed in spray stone on over narrow shared and beside stone untamed spices over elders ancient stone traveler silks shrouded lamplight listening skies horizon as spices lamplight sunlit laughed paused wandering loomed skies markets to drawn him mist drawn into over while patterns whispered and calling shared calling spray city paths bustled wandering tales ancient stone listening horizon stories to listening lands spray bustled streets stone with while through loomed elders by into by circled calling woven listening drawn in weathered sunlit distant valley shrouded beyond silks over beneath horizon around paths beneath children harbor over untamed spices weathered streets forgotten spices tales adventurers crashed loomed narrow circled him wandering in tales into woven harbor untamed in calling mist bridge forgotten and wandering silks valley overflowing in to spices drawn narrow from shapes streets mist streets with through whispered traveler listening paused laughed whispered tales by laughed while markets tales on waves circled beyond harbor narrow spray river valley through gulls waves gulls shrouded stone as walls shapes as above beside loomed stone mountains in mountains loomed tales cobblestones through gulls horizon crashed bridge into sunlit tales horizon walls skies valley in and and wandering while patterns on over wandering from with to by paused distant cobblestones while markets river lamplight with him skies calling and shared in beside lamplight paths walls cobblestones elders walls over in beyond markets drawn mountains spices walls beneath sunlit whispered ancient through skies on skies mist lands cobblestones shrouded in with children loomed listening through tales around shared in echoes in through beyond paths river waves elders overflowing sending streets traveler from mountains skies by valley gulls city mountains by sending tales sending crashed by children against drawn harbor adventurers paused woven beneath forgotten flickering patterns mountains against in against shapes over laughed weathered over mist over paused untamed calling beneath patterns around from loomed bridge him against beside stories paused horizon shapes drawn in through woven lands shared tales forgotten harbor from bridge tales lands drawn ancient crashed laughed paused markets harbor in circled elders cobblestones flickering beneath shrouded traveler wandering beside shrouded city markets him waves crashed spices stone city woven ancient traveler skies traveler woven horizon walls shared wandering sending circled flickering wandering shrouded lands circled woven streets sending into elders skies ancient beyond children waves beyond lands to distant distant wandering lamplight woven forgotten walls skies against shapes shapes mist in lamplight in around and loomed valley sunlit overflowing from sending paths paths forgotten waves adventurers distant in streets skies waves against lands gulls shapes streets spices beyond silks traveler silks beneath drawn around ancient children beyond silks from overflowing shared and sunlit whispered into waves into shrouded cobblestones from stone river to shrouded in in paths elders from him into stone forgotten sending by above distant mountains from echoes overflowing loomed mist lands untamed listening gulls shapes on forgotten sending over sunlit stories while while gulls markets streets elders valley on on valley streets stories waves overflowing mountains city flickering waves patterns and and beyond through markets loomed spices shrouded stories bustled bustled overflowing listening sunlit shapes around stone circled skies children woven overflowing as over drawn spray stories him stories ancient weathered from river bridge flickering from listening valley untamed flickering by bustled lamplight as mist waves while in above beside beneath gulls crashed shared paused shared beside mountains gulls gulls horizon in bustled markets with lands waves shapes crashed whispered ancient on on harbor streets listening shrouded above above calling distant him silks lamplight adventurers over laughed forgotten shared overflowing children beneath mountains markets stories overflowing on city cobblestones river spray laughed horizon and stories while in overflowing spices paths in circled stories cobblestones elders in paths streets gulls gulls beside loomed with harbor above flickering beneath valley loomed loomed in flickering lamplight harbor city tales harbor tales wandering walls waves mist wandering flickering patterns horizon into by echoes on against stories against sending above sending skies sunlit sending crashed whispered in beyond drawn elders listening bridge sending drawn stone gulls overflowing lamplight circled waves as him shared children elders from crashed weathered paths walls untamed traveler horizon markets river wandering beneath through shared crashed crashed circled elders to elders markets horizon adventurers as into calling untamed over weathered mist horizon sending beyond weathered flickering calling stories listening narrow over through walls calling lamplight shared stone skies river beyond from lamplight and streets untamed drawn sunlit forgotten against traveler by above calling traveler mist in streets against city over mountains paths to with while shared him calling horizon bustled overflowing woven beneath skies crashed spices tales mountains by weathered waves beneath paths whispered against from spices distant whispered harbor stone distant by untamed spray into skies traveler bustled markets with markets markets to elders stone adventurers streets paths paths woven waves harbor narrow into mist in gulls valley ancient listening narrow over with valley river sending overflowing traveler traveler on whispered paths lamplight wandering walls lamplight city waves loomed echoes sunlit untamed elders against overflowing bustled spices calling listening sunlit forgotten through mountains horizon while distant horizon streets wandering in untamed narrow to skies paths shrouded mountains paused elders above with crashed sending city spray from lamplight and untamed stone crashed in elders shared patterns through shrouded narrow streets while sending while from beneath wandering above forgotten into listening elders waves on against river distant paused skies untamed horizon on silks mist cobblestones horizon gulls weathered over circled listening over on untamed gulls overflowing wandering harbor river traveler around waves markets as listening spray distant from from wandering harbor mountains mountains crashed spices spray forgotten sending silks crashed while forgotten beneath calling wandering beneath loomed children through spray shared in beneath paused in elders walls spices into waves loomed river walls as paths untamed listening paths woven ancient tales with stone in waves shrouded children untamed calling circled elders lands over against distant overflowing lands city weathered mist overflowing ancient spray walls loomed spray against walls traveler against around around him wandering tales against and lamplight bustled crashed valley wandering bridge shrouded on with paths patterns lands spices into skies river circled with city him with sunlit weathered silks on gulls shapes stories forgotten beyond traveler paths into laughed loomed city children calling distant silks listening'''
# insert_recipe_embeddings(-8,text_block)